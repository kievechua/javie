/**
 * ========================================================================
 * Javie version 1.0.0
 * ========================================================================
 *
 * @package     Javie
 * @require     underscore, console, jQuery/Zepto
 * @version     1.0.1
 * @author      Mior Muhammad Zaki <http://git.io/crynobone>
 * @license     MIT License
 */

(function(){"use strict";var root,Javie,_;root=this;_=root._;if(!_&&"undefined"!==typeof require){_=require("underscore")}if(!_){throw new Error("Expected Underscore.js not available")}Javie=function Javie(env,callback){if(_.isFunction(env)){callback=env;env=null}if((Javie.ENV===env||_.isNull(env))&&_.isFunction(callback)){callback.call(Javie)}};Javie.ENV="production";root.Javie=Javie}).call(this);(function(){"use strict";var root,Events,_,cache;root=this;Events=function(){return Events.make()};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports){exports=module.exports=Events}exports.Events=Events}else{if("undefined"===typeof root.Javie){root.Javie={}}root.Javie.Events=Events}_=root._;if(!_&&"undefined"!==typeof require){_=require("underscore")}if(!_){throw new Error("Expected Underscore.js not available")}Events.make=function make(){var events,self;self=this;if(!_.isNull(cache)&&!_.isUndefined(cache)){return cache}events={};cache={listen:function listen(id,cb){if(!_.isFunction(cb)){throw new Error("Callback is not a function")}if(_.isNull(events[id])||_.isUndefined(events[id])){events[id]=[]}events[id].push(cb);return{id:id,cb:cb}},listener:function listener(id,cb){return this.listen(id,cb)},fire:function fire(id,params){var me,response;me=this;response=[];if(_.isNull(id)){throw new Error("Event ID is not provided: ["+id+"]")}if(_.isNull(events[id])||_.isNull(events[id])){return null}_.each(events[id],function runEachEvent(callback,key){response.push(callback.apply(me,params||[]))});return response},first:function first(id,params){var me,response,first;me=this;response=[];if(_.isNull(id)){throw new Error("Event ID is not provided: ["+id+"]")}if(_.isNull(events[id])||_.isNull(events[id])){return null}first=events[id].slice(0,1);_.each(first,function runEachEvent(callback,key){response.push(callback.apply(me,params||[]))});return response[0]},until:function until(id,params){var me,response;me=this;response=null;if(_.isNull(id)){throw new Error("Event ID is not provided: ["+id+"]")}if(_.isNull(events[id])||_.isNull(events[id])){return null}_.each(events[id],function runEachEvent(callback,key){if(_.isNull(response)){response=callback.apply(me,params||[])}});return null},flush:function flush(id){if(!_.isUndefined(events[id])){events[id]=null}},forget:function forget(handler){var me,id,cb;me=this;id=handler.id;cb=handler.cb;if(!_.isString(id)){throw new Error("Event ID is not provided: ["+id+"]")}if(!_.isFunction(cb)){throw new Error("Callback is not a function")}if(_.isNull(events[id])){throw new Error("No registered event found for ["+id+"]")}_.each(events[id],function loopEachEvent(callback,key){if(callback===cb){events[id].splice(key,1)}})},clone:function clone(id){return{to:function to(cloneTo){events[cloneTo]=_.clone(events[id])}}}};return cache}}).call(this);(function(){"use strict";var root,Logger,_,cache,console;root=this;console=root.console;Logger=function(){return Logger.make()};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports){exports=module.exports=Logger}exports.Logger=Logger}else{if("undefined"===typeof root.Javie){root.Javie={}}root.Javie.Logger=Logger}_=root._;if(!_&&"undefined"!==typeof require){_=require("underscore")}if(!_){throw new Error("Expected Underscore.js not available")}function makeArray(args){return Array.prototype.slice.call(args)}Logger.noConflict=function noConflict(){root.Logger=previous;return this};Logger.enabled=false;Logger.ERROR="error";Logger.WARNING="warning";Logger.INFO="info";Logger.DEBUG="debug";Logger.LOG="log";Logger.enable=function enable(){this.enabled=true};Logger.disable=function disable(){this.enabled=false};Logger.status=function status(){return this.enabled};Logger.make=function make(){var self,post;if(!_.isNull(cache)&&!_.isUndefined(cache)){return cache}self=this;post=function post(type,message){var args;if(self.enabled===false){return null}args=makeArray(arguments);type=args.shift();if(args.length===1){args=args[0]}switch(type){case"info":console.info(args);break;case"debug":console.debug(args);break;case"warning":console.warn(args);break;case"error":console.error(args);break;case"log":console.log(args);break;default:console.log("["+type.toUpperCase()+"]",args);break}};cache={logs:[],info:function info(){var args;args=makeArray(arguments);args.unshift(self.INFO);this.logs.push(args);post.apply(this,args);return this},debug:function debug(){var args;args=makeArray(arguments);args.unshift(self.DEBUG);this.logs.push(args);post.apply(this,args);return this},warning:function warning(){var args;args=makeArray(arguments);args.unshift(self.WARNING);this.logs.push(args);post.apply(this,args);return this},error:function error(){var args;args=makeArray(arguments);args.unshift(self.ERROR);this.logs.push(args);post.apply(this,args);return this},log:function log(){var args;args=makeArray(arguments);args.unshift(self.LOG);this.logs.push(args);post.apply(this,args);return this},post:function post(){var args;args=makeArray(arguments);this.logs.push(args);post.apply(this,args);return this}};return cache}}).call(this);(function(console){"use strict";var root,Profiler,_,caches;root=this;caches={};Profiler=function(name){return Profiler.make(name)};if("undefined"!==typeof exports){if("undefined"!==typeof module&&module.exports){exports=module.exports=Profiler}exports.Profiler=Profiler}else{if("undefined"===typeof root.Javie){root.Javie={}}root.Javie.Profiler=Profiler}_=root._;if(!_&&"undefined"!==typeof require){_=require("underscore")}if(!_){throw new Error("Expected Underscore.js not available")}function schema(){return{id:"",type:"",start:null,end:null,total:null,message:""}}function microtime(asFloat){var ms,sec;ms=(new Date).getTime();sec=parseInt(ms/1e3,10);return asFloat?ms/1e3:(ms-sec*1e3)/1e3+" "+sec}Profiler.enabled=false;Profiler.enable=function enable(){this.enabled=true};Profiler.disable=function disable(){this.enabled=false};Profiler.status=function status(){return this.enabled};Profiler.make=function make(name){var self,cache;if(console===undefined&&this.enabled===true){throw new Error("console is not available.")}if(_.isUndefined(name)||name===""){name="default"}if(caches[name]!==undefined){return caches[name]}self=this;cache={logs:[],pair:{},startedAt:microtime(true),time:function start(id,message){var key,log;if(_.isNull(id)){id=this.logs.length}if(self.enabled===false){return null}log=schema();log.id=id;log.type="time";log.message=message.toString();log.start=microtime(true);if(!_.isUndefined(this.pair["time."+id])){key=this.pair["time."+id];this.logs[key]=log}else{this.logs.push(log);this.pair["time."+id]=this.logs.length-1}console.time(id);return id},timeEnd:function mark(id,message){var key,start,end,total,log;if(_.isNull(id)){id=this.logs.length}if(self.enabled===false){return}if(_.isUndefined(this.pair["time."+id])){log=schema();log.start=this.startedAt;if(!_.isUndefined(message)){log.message=message}this.logs.push(log);this.pair["time."+id]=this.logs.length-1;log.id=id;log.type="time"}else{console.timeEnd(id)}key=this.pair["time."+id];log=this.logs[key];end=log.end=microtime(true);start=log.start;total=end-start;log.total=total;this.logs[key]=log;return total},trace:function trace(){if(self.enabled===false){return}console.trace()},output:function output(autoEnabled){var logs,index,length,current;if(self.enabled===false){if(autoEnabled===true){self.enable()}else{return}}logs=this.logs;length=logs.length;for(index=0;index<length;index=index+1){current=logs[index];if("time"===current.type){console.info("%s: %s - %dms",current.id,current.message,Math.floor(current.total*1e3))}else{console.log(current.id,current.message)}}}};caches[name]=cache;return caches[name]}}).call(this,console);(function(){"use strict";var root,Request,_,api,ev,storage;root=this;Request=function(name){return Request.make(name)};storage={};if("undefined"!==typeof exports){throw new Error("Not supported")}if("undefined"===typeof root.Javie){throw new Error("Javie is required before using Javie.Request")}root.Javie.Request=Request;if("undefined"===typeof root.Javie.Events){throw new Error("Javie is missing Logger and Events")}ev=root.Javie.Events.make();_=root._;if(!_&&"undefined"!==typeof require)_=require("underscore");api=root.$;if("undefined"===typeof api||null===api){throw new Error("Required jQuery or Zepto object is not available.")}function parseJSON(data){if(_.isString(data))data=api.parseJSON(data);return data}Request.config={baseUrl:null,onError:function onError(data,status){},beforeSend:function beforeSend(data,status){},onComplete:function onComplete(data,status){}};Request.put=function put(key,value){var config=!_.isString(key)?key:{key:value};this.config=_.defaults(config,this.config)};Request.make=function make(name){var cache,child,childName,parent,self;if(!_.isString(name))name="default";self=this;if(!_.isUndefined(storage[name])){parent=storage[name];if(parent.executed===true){childName=_.uniqueId(name+"_");child=self.make(childName);ev.clone("Request.onError: "+name).to("Request.onError: "+childName);ev.clone("Request.onComplete: "+name).to("Request.onComplete: "+childName);ev.clone("Request.beforeSend: "+name).to("Request.beforeSend: "+childName);child.put(parent.config);return child}return parent}cache={executed:false,to:function to(url,object,dataType){var own,r,type,uri,tmp;own=this;if(_.isUndefined(url)){throw new Error("Missing required parameter.")}if(_.isNull(object))object=root.document;r=url.split(" ");type="GET";own.put({name:name,type:"GET",query:"",data:"",dataType:!_.isUndefined(dataType)?dataType:"json",id:"",object:object});if(r.length===1)uri=r[0];else{if(_.indexOf(["POST","GET","PUT","DELETE"],r[0])>-1){type=r[0]}uri=r[1];if(type!=="GET"){tmp=uri.split("?");if(tmp.length>1){uri=tmp[0];own.put("query",tmp[1])}}own.put({type:type,uri:uri})}own.put("id","#"+api(own.get("object")).attr("id"));return this},execute:function execute(){var own,data;own=this;data=api(own.get("object")).serialize()+"&"+own.get("query");if(data==="?&")data="";own.executed=true;ev.fire("Request.beforeSend",[own]);ev.fire("Request.beforeSend: "+name,[own]);own.config.beforeSend(own);api.ajax({type:own.get("type"),dataType:own.get("dataType"),url:own.get("uri"),data:data,complete:function complete(xhr){var data,status;if(xhr.responseText!==""){data=parseJSON(xhr.responseText);status=xhr.status;if(data.hasOwnProperty("errors")){ev.fire("Request.onError",[data.errors,status,own]);ev.fire("Request.onError: "+name,[data.errors,status,own]);own.config["onError"](data.errors,status,own);data.errors=null}ev.fire("Request.onComplete",[data,status,own]);ev.fire("Request.onComplete: "+name,[data,status,own]);own.config.onComplete(data,status,own)}}})},config:{name:"",type:"GET",uri:"",query:"",data:"",dataType:"json",id:"",object:null},put:function put(key,value){var config=!_.isString(key)?key:{key:value};this.config=_.defaults(config,this.config)},get:function get(key,defaults){if(_.isUndefined(defaults))defaults=null;return!_.isUndefined(this.config[key])?this.config[key]:defaults}};cache.config=_.defaults(cache.config,self.config);storage[name]=cache;return storage[name]}}).call(this);